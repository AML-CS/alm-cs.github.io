<!doctype html><html lang=en-us><head><title>AML-CS | Uninorte</title><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=.5,maximum-scale=3"><meta charset=utf-8><meta name=description content="Applied Math and Computer Science Laboratory (AML-CS) at Universidad del Norte in Barranquilla"><meta property="og:title" content="AML-CS | Uninorte"><meta property="og:description" content="Applied Math and Computer Science Laboratory (AML-CS) at Universidad del Norte in Barranquilla"><meta property="og:image" content="https://aml-cs.github.io/images/logo.jpg"><meta property="og:url" content="https://aml-cs.github.io/"><meta name=twitter:card content="Applied Math and Computer Science Laboratory (AML-CS) at Universidad del Norte in Barranquilla"><meta property="og:site_name" content="AML-CS | Uninorte"><link rel=stylesheet href=/bundle.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/glider-js@1/glider.min.css><meta name=generator content="Hugo 0.82.0"><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/javascript src=/bundle.min.js></script><script src=https://cdn.jsdelivr.net/npm/glider-js@1/glider.min.js></script></head><body><div id=container><div id=header><div id=site-logo><img src=https://aml-cs.github.io/images/logo.jpg alt="AML-CS logo"></div></div><nav><ul class=first><li><a href=/>Home</a></li><li><a href=/posts/>Posts</a></li><li><a href=/talks/>Talks &#187;</a><ul class=second><li><a href=/talks/talk-series/>Talk Series</a></li><li><a href=/talks/elias-ni%C3%B1o/>Talks by Dr. Elias Nino-Ruiz</a></li></ul></li><li><a href=/events/>Events &#187;</a><ul class=second><li><a href=/events/3rd-international-da-workshop/>3rd International Workshop on Data Assimilation</a></li></ul></li><li><a href=/call-for-papers/>Call for Papers &#187;</a><ul class=second><li><a href=/call-for-papers/ijai-2022/>Special Issue of IJAI - 2022</a></li></ul></li><li><a href=/current-students/>Current Students</a></li><li><a href=/former-students/>Former Students</a></li><li><a href=/publications/>Publications</a></li><li><a href=/awards/>Awards</a></li><li><a href=/wrf-baq-0.5km/>WRF BAQ Forecast</a></li></ul></nav><div id=content><h1>WRF + WRFDA Uninorte HPC</h1><article><p class=timestamp>June 2, 2021</p><div class=article-body><p>The following guide show how to install, configure and run the Weather Research and Forecasting Model (WRF) and it&rsquo;s most popular module WRFDA in CentOS 7 - OpenHPC.</p><h2 id=setup>Setup</h2><p>The <code>setup-WRF.sh</code>, <code>setup-WRFDA-3DVAR.sh</code> and <code>setup-WRFDA-4DVAR.sh</code> scripts will download and install all the dependencies needed to run WRF and WRFDA. Make sure to select the following options during the build process:</p><ul><li>WRF: 34, 1 for gfortran and distributed memory</li><li>WPS: 3</li><li>WRFDA-3DVAR: 34 distributed memory</li></ul><p>When the script are done, the new modules can be loaded:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>module load wrf/4.3 wrfda/4.3-3dvar
</code></pre></div><p>On loading the modules, the following scripts will be available for use:</p><ul><li>download-geog-data</li><li>download-grib</li><li>download-obs</li><li>download-prep</li><li>generate-wrfda-be</li><li>run-wps</li><li>run-wrf</li><li>run-wrfda</li><li>run-obsproc</li><li>run-arwpost</li><li>run-arwpost-ensemble</li></ul><p>All of them are self-descriptive, you can find out how to use them by typing <code>--help</code>:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>run-wrf --help
usage: run_wrf.py <span style=color:#000;font-weight:700>[</span>-h<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span>-i interval<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span>-g grid_size<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span>-o output<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span>-n ntasks<span style=color:#000;font-weight:700>]</span>
                  <span style=color:#000;font-weight:700>[</span>--only-wrf<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span>--only-real<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span>--srun<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span>-d<span style=color:#000;font-weight:700>]</span>
                  start_date end_date

Run WRF real.exe or wrf.exe

positional arguments:
  start_date            First perturbation valid date <span style=color:#000;font-weight:700>(</span>YYYY-mm-dd H<span style=color:#000;font-weight:700>)</span>
  end_date              Last perturbation valid date <span style=color:#000;font-weight:700>(</span>YYYY-mm-dd H<span style=color:#000;font-weight:700>)</span>

optional arguments:
  -h, --help            show this <span style=color:#0086b3>help</span> message and <span style=color:#0086b3>exit</span>
  -i interval, --interval interval
                        Hours interval, default: <span style=color:#099>6</span>
  -g grid_size, --grid-size grid_size
                        Grid size <span style=color:#000;font-weight:700>(</span>meters<span style=color:#000;font-weight:700>)</span>, default: None
  -o output, --output output
                        Output directory
  -n ntasks, --ntasks ntasks
                        MPI processors or SLURM tasks
  --only-wrf            Run only wrf.exe
  --only-real           Run only real.exe
  --srun                Run with srun <span style=color:#000;font-weight:700>(</span>inside sbatch or salloc<span style=color:#000;font-weight:700>)</span>
  -d, --debug           Debug mode
</code></pre></div><h2 id=run-wrf-step-by-step>Run WRF step by step</h2><ol><li>First create a new SLRUM job allocation</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>salloc --job-name <span style=color:#d14>&#34;wrf-test&#34;</span> --ntasks<span style=color:#000;font-weight:700>=</span><span style=color:#099>72</span> -t 24:00:00 -A syseng -p syseng
</code></pre></div><ol start=2><li>Load modules</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>module load wrf/4.3
</code></pre></div><ol start=3><li>Move to your workspace (or create a new one)</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=color:#0086b3>cd</span> /work/syseng/users/<span style=color:teal>$USERNAME</span>/workspace/wrf-test
</code></pre></div><ol start=4><li>(if not exists) Download observations</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>download-grib <span style=color:#d14>&#34;2022-01-01&#34;</span> <span style=color:#d14>&#34;2022-01-31&#34;</span>
</code></pre></div><ol start=5><li>Run geogrid + ungrid + metgrid (&ndash;help or &ndash;debug for more info)</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>run-wps <span style=color:#d14>&#34;2022-01-01 00&#34;</span> <span style=color:#d14>&#34;2022-01-31 18&#34;</span> -i <span style=color:#099>6</span> -g <span style=color:#099>1000</span> --data-dir ./grib-obs
</code></pre></div><ol start=6><li>Run real.exe (&ndash;help or &ndash;debug for more info)</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>run-wrf <span style=color:#d14>&#34;2022-01-06 00&#34;</span> <span style=color:#d14>&#34;2022-01-07 00&#34;</span> -i <span style=color:#099>6</span> -n <span style=color:#099>8</span> -g <span style=color:#099>1000</span> --srun --only-real
</code></pre></div><ol start=7><li>Run wrf.exe (&ndash;help or &ndash;debug for more info)</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>run-wrf <span style=color:#d14>&#34;2022-01-06 00&#34;</span> <span style=color:#d14>&#34;2022-01-07 00&#34;</span> -i <span style=color:#099>6</span> -n <span style=color:#099>64</span> -g <span style=color:#099>1000</span> --srun --only-wrf --output /work/syseng/users/<span style=color:teal>$USERNAME</span>/workspace/wrf-test/wrf_output
</code></pre></div><ol start=8><li>(optional) watch real-time logs</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>tail -f <span style=color:teal>$WRF_DIR</span>/run/rsl.error.*
</code></pre></div><ol start=9><li>(optional) cancel jobs by user</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>scancel --user<span style=color:#000;font-weight:700>=</span><span style=color:teal>$USERNAME</span>
</code></pre></div><h2 id=run-wrfda-step-by-step>Run WRFDA step by step</h2><ol><li>First create a new SLRUM job allocation</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>salloc --job-name <span style=color:#d14>&#34;wrfda-test&#34;</span> --ntasks<span style=color:#000;font-weight:700>=</span><span style=color:#099>72</span> -t 24:00:00 -A syseng -p syseng
</code></pre></div><ol start=2><li>Load modules</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>module load wrf/4.3 wrfda/4.3
</code></pre></div><ol start=3><li>Move to your workspace (or create a new one)</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=color:#0086b3>cd</span> /work/syseng/users/<span style=color:teal>$USERNAME</span>/workspace/wrfda-test
</code></pre></div><ol start=4><li>(if not exists) Download observations</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>download-grib <span style=color:#d14>&#34;2022-01-01&#34;</span> <span style=color:#d14>&#34;2022-01-31&#34;</span>
</code></pre></div><ol start=5><li>Run geogrid + ungrid + metgrid (&ndash;help or &ndash;debug for more info)</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>run-wps <span style=color:#d14>&#34;2022-01-01 00&#34;</span> <span style=color:#d14>&#34;2022-01-31 18&#34;</span> -i <span style=color:#099>6</span> -g <span style=color:#099>1000</span> --data-dir ./grib-obs
</code></pre></div><ol start=6><li>Generate first guest wrf.exe (&ndash;help or &ndash;debug for more info)</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>run-wrf <span style=color:#d14>&#34;2022-01-06 18&#34;</span> <span style=color:#d14>&#34;2022-01-07 00&#34;</span> -i <span style=color:#099>6</span> -n <span style=color:#099>64</span> -g <span style=color:#099>1000</span> --srun --only-wrf --output /work/syseng/users/<span style=color:teal>$USERNAME</span>/workspace/wrfda-test/wrf_output
</code></pre></div><ol start=7><li>Generate background error (&ndash;help or &ndash;debug for more info)</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>generate-wrfda-be <span style=color:#d14>&#34;2022-01-06 12&#34;</span> <span style=color:#d14>&#34;2022-01-10 12&#34;</span> -i <span style=color:#099>6</span> -n <span style=color:#099>64</span> -g <span style=color:#099>1000</span> --data-dir ./ --srun
</code></pre></div><ol start=8><li>Download prepbufr observations (ucar.edu)</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>download-prep <span style=color:#d14>&#34;2022-01-01&#34;</span> <span style=color:#d14>&#34;2022-01-31&#34;</span>
</code></pre></div><ol start=9><li>Generate ensemble (&ndash;help or &ndash;debug for more info)</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>run-wrfda <span style=color:#d14>&#34;2022-01-06 18&#34;</span> <span style=color:#d14>&#34;2022-01-07 00&#34;</span> -i <span style=color:#099>6</span> -n <span style=color:#099>64</span> -g <span style=color:#099>1000</span> -o ./wrfda-test --srun --generate-ensemble <span style=color:#099>1</span>
</code></pre></div><ol start=10><li>(optional) watch real-time logs</li></ol><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash>tail -f <span style=color:teal>$WRF_DIR</span>/run/rsl.error.*
</code></pre></div><h2 id=arw-post>ARW-Post</h2><p>This module generate GrADS and/or Vis5D input files from WRF ARW output files that allow to visualize the data in GrADS or Python. For this is necessary to modify the namelist.ARWpost file with the desired parameters, this file is located at <code>${ARW_DIR}</code> directory. Then execute the following command.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell>run-arwpost -f <span style=color:#000;font-weight:700>[</span>INITIAL DATE<span style=color:#000;font-weight:700>]</span> -t <span style=color:#000;font-weight:700>[</span>FINAL DATE<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span>INPUT NAMEFILE<span style=color:#000;font-weight:700>]</span> <span style=color:#000;font-weight:700>[</span>OUTPUT FILENAME<span style=color:#000;font-weight:700>]</span>
</code></pre></div><p><strong>Example</strong></p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell>run-arwpost -f <span style=color:#d14>&#34;2020-01-01 00&#34;</span> -t <span style=color:#d14>&#34;2020-01-02 18&#34;</span> wrf_output data
</code></pre></div><pre><code class="language-=shell" data-lang="=shell">Configure namelist.ARWpost...

!!!!!!!!!!!!!!!!
  ARWpost v3.1
!!!!!!!!!!!!!!!!

FOUND the following input files:
 /home/syseng/omejiaa/workspace/wrf_output

START PROCESSING DATA

 Processing  time --- 2020-01-01_00:00:00
   Found the right date - continue

   ...

 Processing  time --- 2020-01-02_18:00:00
   Found the right date - continue

DONE Processing Data

CREATING .ctl file

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!  Successful completion of ARWpost  !
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!

</code></pre><p>Once executed, download the <code>OUTPUT FILENAME.ctl</code> and <code>OUTPUT FILENAME.dat</code> files, with which you can view the results of the model in the GrADS tool or in Python.</p><h2 id=arw-post-for-ensembles>ARW-Post for ensembles</h2><p>This module generate GrADS and/or Vis5D input files from WRF ARW output files that allow to visualize the data in GrADS or Python. For this is necessary to modify the namelist.ARWpost file with the desired parameters, this file is located at <code>${ARW_DIR}</code> directory. Then execute the following command.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell>run-arw-ensemble -f <span style=color:#000;font-weight:700>[</span>INITIAL DATE<span style=color:#000;font-weight:700>]</span> -t <span style=color:#000;font-weight:700>[</span>FINAL DATE<span style=color:#000;font-weight:700>]</span> -d <span style=color:#000;font-weight:700>[</span>FILES DIRECTORY<span style=color:#000;font-weight:700>]</span>
</code></pre></div><p><code>[INITIAL DATE]</code> and <code>[FINAL DATE]</code> in the format <code>"YYYY-MM-DD HH"</code></p><p><strong>Example</strong></p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell>run-arwpost-ensemble -f <span style=color:#d14>&#34;2020-01-01 00&#34;</span> -t <span style=color:#d14>&#34;2020-01-02 18&#34;</span> -d wrfda_2021-06-03-22.10.29
</code></pre></div><pre><code class="language-=shell" data-lang="=shell">Configure namelist.ARWpost...

!!!!!!!!!!!!!!!!
  ARWpost v3.1
!!!!!!!!!!!!!!!!

FOUND the following input files:
 /home/syseng/sjdonado/workspace/wrfda_2021-06-03-22.10.29/m1

START PROCESSING DATA

 Processing  time --- 2020-01-01_00:00:00
   Found the right date - continue

 Processing  time --- 2020-01-01_01:00:00
   Found the right date - continue

 Processing  time --- 2020-01-01_02:00:00
   Found the right date - continue

 Processing  time --- 2020-01-01_03:00:00
   Found the right date - continue

 ...


 Processing  time --- 2020-01-02_18:00:00
   Found the right date - continue

DONE Processing Data

CREATING .ctl file

!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!  Successful completion of ARWpost  !
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</code></pre><p>Once executed, download the <code>ensemble-m1.ctl</code> and <code>ensemble-m1.dat</code> files, with which you can view the results of the model in the GrADS tool or in Python.</p><h2 id=grads>GrADS</h2><p>The Grid Analysis and Display System (GrADS) is an interactive desktop tool that is used for easy access, manipulation, and visualization of earth science data. GrADS has two data models for handling gridded and station data. GrADS supports many data file formats, including binary (stream or sequential), GRIB (version 1 and 2), NetCDF, HDF (version 4 and 5), and BUFR (for station data). GrADS has been implemented worldwide on a variety of commonly used operating systems and is freely distributed over the Internet.</p><p>This guide shows a quick way to visualize an ensemble in GrADS, for this we download the <code>.ctl</code> and <code>.dat</code> files, then we open GrADS and go to the directory where the files were saved.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-shell data-lang=shell><span style=color:#0086b3>cd</span> <span style=color:#000;font-weight:700>[</span>DIRECTORY<span style=color:#000;font-weight:700>]</span>
</code></pre></div><p>Once in the directory we open the file by executing the following command.
<code>open [filename]</code>
To visualize the behaviour of the <code>u</code> and <code>v</code> components of the wing and the value of this follow the next commands</p><pre><code>set gxout stream
set t 1 43
set lopping on
d u;v;mag(u,v)
</code></pre></div></article></div><div id=footer>Copyright 2022 Universidad del Norte, Colombia.</div></div></body></html>