MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],processEscapes:!0}}),document.addEventListener('DOMContentLoaded',function(a){for(let a=0,b=document.links,c=b.length;a<c;a++)b[a].hostname!=window.location.hostname&&(b[a].target='_blank')}),window.initWRFBaqApp=async function(){const e='https://api.github.com/repos/AML-CS/wrf-baq-0.5km',f='https://raw.githubusercontent.com/AML-CS/wrf-baq-0.5km',n=new URLSearchParams(document.location.search).get('report_sha')||'master',a={itemsPerPage:15,currentPage:1,loading:!1},c={pwater:'Precipitable Water',wind:'Wind speed',temp:'Temperature',uwind:'U wind speed',vwind:'V wind speed',press:'Pressure'};function b(a){return fetch(a).then(a=>a.json()).catch(a=>{console.error(a),r()})}async function m(a){const{files:g}=await b(`${e}/commits/${a}`),h=await b(`${f}/${a}/output/report.json`),c={},d={},i=new RegExp(/output\/(.*)\..*/);return await Promise.all(g.map(async({filename:e,contents_url:h})=>{const g=i.exec(e)[1];if(e.includes('.gif')&&(c[g]=`${f}/${a}/${e}`),e.includes('.html')){const{content:a}=await b(h);d[g]=`data:text/html;base64,${a}`}})),{report:h,images:c,folium:d}}async function l(a){const{currentPage:c,itemsPerPage:d}=a;a.loading=!0;const f=await b(`${e}/commits?page=${c}&per_page=${d}`),g=f.map(({sha:b,commit:a})=>{if(a.message.includes('BAQ 0.5km WRF output'))return{message:a.message,sha:b}}).filter(Boolean);return a.loading=!1,g}function k(a){const d=document.getElementById('report-title'),b=document.getElementById('report-data');d.innerHTML=`Report: ${a.createdAt}`,b.innerHTML='';const c={createdAt:a=>['Updated',`${a} UTC`],startDate:a=>['WRF Start Date',`${a}:00 UTC`],endDate:a=>['WRF End Date',`${a}:00 UTC`],gfsUrls:a=>[`<a href="https://registry.opendata.aws/noaa-gfs-bdp-pds/" target="_blank" rel="noopener noreferrer nofollow">NOAA - GFS data</a>`,a.map(a=>`<a href="https://noaa-gfs-bdp-pds.s3.amazonaws.com/index.html#${a}" target="_blank" rel="noopener noreferrer nofollow">${a}</a>`).join('<br>')],ogimetUrl:a=>[`<a href="https://www.ogimet.com/home.phtml.en" target="_blank" rel="noopener noreferrer nofollow">OGIMET</a> query`,`<a href="${a}" target="_blank" rel="noopener noreferrer nofollow">${a}</a>`],ogimetStationCoordinates:a=>['SKBQ station',`<a href="https://www.google.com/maps/place/${a.join(',')}" target="_blank" rel="noopener noreferrer nofollow" >${a.join(',')}</a>`],interpolatedVariables:a=>['Interpolated variables',a.join('<br>').replace(/:fcst(.*?):from [0-9]+/g,'')]};Object.entries(a).forEach(([d,g])=>{const a=document.createElement('tr'),e=document.createElement('td'),f=document.createElement('td');if(d in c){const[h,i]=c[d](g);e.innerHTML=h,f.innerHTML=i,a.appendChild(e),a.appendChild(f),b.appendChild(a)}})}function j(b){const a=document.getElementById('all-reports');a.innerHTML='',b.forEach(({message:e,sha:f})=>{const b=document.createElement('tr'),c=document.createElement('td'),d=document.createElement('td');c.innerHTML=e,d.innerHTML=`<a href="${window.location.href}?report_sha=${f}" target="_blank" rel="noopener noreferrer nofollow">See report</a>`,b.appendChild(c),b.appendChild(d),a.appendChild(b)})}function i(d,b,e){const a=document.getElementById(d),c=document.createElement(b);Object.entries(e).forEach(([a,b])=>{c[a]=b}),a.querySelector(b)&&a.removeChild(a.querySelector(b)),a.appendChild(c)}function h(a,b){i('maps-folium','iframe',{src:b,title:c[a]})}function g(a,b){i('maps-gif','img',{src:b,alt:c[a]})}function o(e,a,b){const d=document.getElementById('variables-select');e.ncVariables.forEach((e,i)=>{const f=document.createElement('option');f.value=e,f.textContent=c[e],i===0&&(f.selected=!0,g(e,a[e]),h(e,b[e])),d.appendChild(f)}),d.addEventListener('change',d=>{const c=d.target.value;g(c,a[c]),h(c,b[c])})}function p(){const b=document.getElementById('newer'),c=document.getElementById('older');b.addEventListener('click',g=>{const{currentPage:e,loading:f}=a;if(f)return;e>1&&(a.currentPage-=1),a.currentPage===1&&(b.disabled=!0),d(),c.disabled=!1}),c.addEventListener('click',async h=>{const{loading:e,itemsPerPage:f}=a;if(e)return;a.currentPage+=1;const g=await d();g<f&&(a.currentPage-=1,c.disabled=!0),b.disabled=!1})}function q(){const a=document.getElementById('wrf-baq-app');a.classList.remove('hide')}function r(){const a=document.getElementById('wrf-baq-app');a.classList.add('hide')}async function s(){const{report:a,images:b,folium:c}=await m(n);if(Object.keys(a).length>=7)return o(a,b,c),k(a),!0}async function d(){const b=await l(a);if(b.length>0)return p(),j(b),b.length}await s()&&await d()>0&&q()}